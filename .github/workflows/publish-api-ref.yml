name: Publish API reference

on:
  push:
    tags:
    - '*'

jobs:
  build:
    runs-on: macos-12
    steps:
    - name: Generate API reference doc
      uses: actions/checkout@v3
      run: |
        swift package --allow-writing-to-directory doc-temp \
            generate-documentation --target Yorkie \
            --disable-indexing \
            --output-path doc-temp  \
            --transform-for-static-hosting \
            --hosting-base-path hyeongsik-won/playground
    - name: Publish API reference doc
      uses: actions/checkout@v3
      with:
              ref: api-ref-doc
      run: |
        rm -rf docs
        mv doc-temp docs
        git add docs
        git commit -m "Updates docs for $GITHUB_REF_NAME"
        git push
